{% extends 'core/base.html' %}

{% block title %}Novo Cliente | AgencyOS{% endblock %}

{% block content %}
<div class="card border-0 shadow-sm p-4">
    <div class="d-flex align-items-center mb-4">
        <div class="bg-primary text-white rounded-3 p-3 me-3" style="background-color: #6c5ce7 !important;">
            <i class="bi bi-person-plus-fill fs-3"></i>
        </div>
        <div>
            <h2 class="mb-0">Novo Cliente</h2>
            <p class="text-muted mb-0">Cadastre os dados e redes sociais do seu cliente</p>
        </div>
    </div>

    <form method="post">
        {% csrf_token %}
        <ul class="nav nav-tabs mb-4" id="clientTabs" role="tablist">
            <li class="nav-item"><a class="nav-link active" data-bs-toggle="tab" href="#dados"><i class="bi bi-info-circle me-2"></i>Geral</a></li>
            <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#endereco"><i class="bi bi-geo-alt me-2"></i>Endereço</a></li>
            <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#contatos"><i class="bi bi-share me-2"></i>Redes Sociais</a></li>
        </ul>

        <div class="tab-content">
            <div class="tab-pane fade show active" id="dados">
                <div class="row g-3">
                    <div class="col-md-6"><label class="form-label fw-bold small text-muted">Nome Fantasia</label>{{ form.nome_fantasia }}</div>
                    <div class="col-md-6"><label class="form-label fw-bold small text-muted">CPF ou CNPJ</label>{{ form.documento }}</div>
                    <div class="col-md-12"><label class="form-label fw-bold small text-muted">Razão Social</label>{{ form.razao_social }}</div>
                    <div class="col-md-6"><label class="form-label fw-bold small text-muted">E-mail</label>{{ form.email }}</div>
                    <div class="col-md-6"><label class="form-label fw-bold small text-muted">Telefone Geral</label>{{ form.telefone }}</div>
                    <div class="col-md-6"><label class="form-label fw-bold small text-muted">Pessoa de Contato</label>{{ form.nome_contato }}</div>
                    <div class="col-md-6"><label class="form-label fw-bold small text-muted">WhatsApp do Contato</label>{{ form.whatsapp_contato }}</div>
                </div>
            </div>

            <div class="tab-pane fade" id="endereco">
                <div class="row g-3">
                    <div class="col-md-3"><label class="form-label fw-bold small text-muted">CEP</label>{{ form.cep }}</div>
                    <div class="col-md-9"><label class="form-label fw-bold small text-muted">Logradouro</label>{{ form.endereco }}</div>
                    <div class="col-md-5"><label class="form-label fw-bold small text-muted">Bairro</label>{{ form.bairro }}</div>
                    <div class="col-md-5"><label class="form-label fw-bold small text-muted">Cidade</label>{{ form.cidade }}</div>
                    <div class="col-md-2"><label class="form-label fw-bold small text-muted">UF</label>{{ form.estado }}</div>
                </div>
            </div>

            <div class="tab-pane fade" id="contatos">
                <h5 class="mb-3 text-muted">Quais redes sociais o cliente utiliza?</h5>
                <div class="row g-2 mb-4">
                    {% for codigo, field in form.fields.items %}
                        {% if "rede_" in codigo %}
                            <div class="col-md-4 col-6">
                                <div class="form-check p-3 border rounded bg-white h-100">
                                    <input class="form-check-input rede-checkbox" type="checkbox" id="check_{{ codigo }}" data-rede="{{ codigo }}">
                                    <label class="form-check-label fw-bold w-100" for="check_{{ codigo }}">
                                        {{ codigo|cut:"rede_"|capfirst }}
                                    </label>
                                </div>
                            </div>
                        {% endif %}
                    {% endfor %}
                </div>
                <div class="row g-3">
                    {% for codigo, field in form.fields.items %}
                        {% if "rede_" in codigo %}
                            <div class="col-md-6 d-none" id="div_{{ codigo }}">
                                <label class="form-label fw-bold small text-muted">Perfil no {{ codigo|cut:"rede_"|capfirst }}</label>
                                <input type="text" name="{{ codigo }}" class="form-control" placeholder="@usuario">
                            </div>
                        {% endif %}
                    {% endfor %}
                </div>
            </div>
        </div>

        <div class="mt-5 border-top pt-4 text-end">
            <button type="submit" class="btn btn-primary px-5 shadow">Salvar Cliente</button>
        </div>
    </form>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Máscaras
    IMask(document.getElementById('doc_field'), {
        mask: [{ mask: '000.000.000-00', maxLength: 11 }, { mask: '00.000.000/0000-00' }]
    });
    IMask(document.getElementById('phone_field'), {
        mask: [{ mask: '(00) 0000-0000' }, { mask: '(00) 00000-0000' }]
    });
    IMask(document.getElementById('whatsapp_field'), {
        mask: [{ mask: '(00) 0000-0000' }, { mask: '(00) 00000-0000' }]
    });

    // Lógica Redes Sociais
    document.querySelectorAll('.rede-checkbox').forEach(checkbox => {
        checkbox.addEventListener('change', function() {
            const redeID = this.getAttribute('data-rede');
            const inputDiv = document.getElementById('div_' + redeID);
            if (this.checked) inputDiv.classList.remove('d-none');
            else {
                inputDiv.classList.add('d-none');
                inputDiv.querySelector('input').value = '';
            }
        });
    });
</script>
{% endblock %}